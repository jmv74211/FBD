!function(s){function webpackJsonpCallback(e){for(var t,r,a=e[0],n=e[1],i=e[2],o=0,l=[];o<a.length;o++)r=a[o],u[r]&&l.push(u[r][0]),u[r]=0;for(t in n)Object.prototype.hasOwnProperty.call(n,t)&&(s[t]=n[t]);for(d&&d(e);l.length;)l.shift()();return c.push.apply(c,i||[]),checkDeferredModules()}function checkDeferredModules(){for(var e,t=0;t<c.length;t++){for(var r=c[t],a=!0,n=1;n<r.length;n++){var i=r[n];0!==u[i]&&(a=!1)}a&&(c.splice(t--,1),e=__webpack_require__(__webpack_require__.s=r[0]))}return e}var r={},u={2:0},c=[];function __webpack_require__(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return s[e].call(t.exports,t,t.exports,__webpack_require__),t.l=!0,t.exports}__webpack_require__.m=s,__webpack_require__.c=r,__webpack_require__.d=function(e,t,r){__webpack_require__.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},__webpack_require__.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.t=function(t,e){if(1&e&&(t=__webpack_require__(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(__webpack_require__.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)__webpack_require__.d(r,a,function(e){return t[e]}.bind(null,a));return r},__webpack_require__.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return __webpack_require__.d(t,"a",t),t},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.p="/anybird/static/build/";var e=window.webpackJsonp=window.webpackJsonp||[],t=e.push.bind(e);e.push=webpackJsonpCallback,e=e.slice();for(var a=0;a<e.length;a++)webpackJsonpCallback(e[a]);var d=t;c.push([690,0]),checkDeferredModules()}({298:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={PQ_ENTRY_CATEGORY:"PQ Entry",ACTION_MODAL_FLOW:"Modal Login",OREILLY_HOST:"www.oreilly.com",LEARNING_OREILLY_HOST:"https://learning.oreilly.com",SAFARI_DOMAIN:"https://www.safaribooksonline.com"},e.exports=t.default},690:function(e,t,r){r(131),e.exports=r(691)},691:function(e,t,r){"use strict";r(692);var a=_interopRequireDefault(r(2)),n=r(170),i=_interopRequireDefault(r(297)),o=(r(298),_interopRequireDefault(r(693)));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var l=new i.default(window.location.search),s=document.getElementsByTagName("html")[0],u={readingUrl:l.get("next")||s.getAttribute("data-reading-url")||s.getAttribute("data-url"),signInUrl:"/accounts/login/?next="+(l.get("next")||s.getAttribute("data-url")),forceShow:0<=window.location.href.search(/\?ar/)||0<parseInt(s.getAttribute("data-force-show"),10),redirectToSafari:0<=window.location.hostname.search("www.oreilly.com")&&!l.get("tofupqtest"),ssoMsgTimeoutMs:4e3},c=document.createElement("div");c.id="academic-modal",document.getElementsByTagName("body")[0].appendChild(c),(0,n.render)(a.default.createElement(o.default,u),c)},693:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,t,r){return t&&defineProperties(e.prototype,t),r&&defineProperties(e,r),e}}(),n=r(2),i=_interopRequireDefault(n),o=_interopRequireDefault(r(0)),l=_interopRequireDefault(r(297)),s=_interopRequireDefault(r(694)),u=_interopRequireDefault(r(89)),c=r(298);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function StudentIntercept(n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,StudentIntercept);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(StudentIntercept.__proto__||Object.getPrototypeOf(StudentIntercept)).call(this,n)),e=new l.default(window.location.search);return i.state={show:!1,universityLogo:"",uiState:"capture",email:e.get("email")||"",timestamp:e.get("tstamp")||"",signature:e.get("id")||"",error:""},i.analytics=new u.default,i.get(i.modifyPathIfHostNameMatches("/api/v1/account-summary-by-network/")).then(function(e){if(e.sso_login_url)setTimeout(function(){i.redirectToSsoLoginUrl(e.sso_login_url)},n.ssoMsgTimeoutMs);else{if(i.props.redirectToSafari){var t=i.returnWindowPathName();t=window.location.search?""+c.SAFARI_DOMAIN+t+window.location.search+"&orpq":""+c.SAFARI_DOMAIN+t+"?orpq",i.redirectToSafariUrl(t)}i.trackOpen()}var r="capture";i.state.email&&i.state.timestamp&&i.state.signature?(r="ezproxy-sso",i.registerUser()):e.sso_login_url&&(r="sso");var a={show:!0,universityLogo:e.logo,uiState:r};i.setState(a)}).catch(function(){if(i.props.forceShow)if(i.props.redirectToSafari){var e=i.returnWindowPathName();e=window.location.search?""+c.SAFARI_DOMAIN+e+window.location.search+"&orpq":""+c.SAFARI_DOMAIN+e+"?orpq",i.redirectToSafariUrl(e)}else i.trackOpen(),i.setState({show:!0})}),i.determineSsoStatus=i.determineSsoStatus.bind(i),i.handleInputChange=i.handleInputChange.bind(i),i.handleStartReading=i.handleStartReading.bind(i),i.registerUser=i.registerUser.bind(i),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(StudentIntercept,n.Component),a(StudentIntercept,[{key:"track",value:function(e,t,r){this.analytics.track(e,t,r)}},{key:"trackOpen",value:function(){this.track(c.PQ_ENTRY_CATEGORY,c.ACTION_MODAL_FLOW,"modal view")}},{key:"trackSubmitEmail",value:function(){this.track(c.PQ_ENTRY_CATEGORY,c.ACTION_MODAL_FLOW,"submit email")}},{key:"trackStartsReading",value:function(){this.track(c.PQ_ENTRY_CATEGORY,c.ACTION_MODAL_FLOW,"temp access")}},{key:"handleStartReading",value:function(){this.trackStartsReading()}},{key:"handleInputChange",value:function(e){this.setState({email:e.target.value})}},{key:"returnWindowPathName",value:function(){return window.location.pathname}},{key:"get",value:function(e){var r=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return fetch(e,{method:"GET",credentials:"same-origin"}).then(function(e){if(e.ok)return r?e.text():e.json();var t=new Error(e.statusText);throw t.response=e,t})}},{key:"post",value:function(e,t){return fetch(e,{method:"POST",body:JSON.stringify(t),credentials:"same-origin"}).then(function(e){if(e.ok)return e.json();if(422===e.status)return e.json().then(function(e){var t=new Error;throw t.response=e,t});throw new Error(e.statusText)})}},{key:"redirectToSsoLoginUrl",value:function(e){window.location.replace(e+"&state="+encodeURIComponent(this.props.readingUrl))}},{key:"redirectToSafariUrl",value:function(e){window.location.replace(e)}},{key:"modifyPathIfHostNameMatches",value:function(e){return"www.oreilly.com"===window.location.hostname?""+c.LEARNING_OREILLY_HOST+e:e}},{key:"determineSsoStatus",value:function(){var t=this,e=this.state.email.split("@");if(2===e.length)return this.get(this.modifyPathIfHostNameMatches("/api/v1/sso/account/lookup?domain="+e[1])).then(function(e){t.setState({uiState:"loading"}),t.redirectToSsoLoginUrl(e.sso_login_url)}).catch(function(e){t.registerUser()});this.registerUser()}},{key:"registerUser",value:function(){var r=this,e=this.state,t={email:e.email,timestamp:e.timestamp,signature:e.signature};this.props.forceShow&&(t.ar=!0),this.setState({uiState:"loading"}),this.post(this.modifyPathIfHostNameMatches("/api/v1/user/pq-student/"),t).then(function(){r.trackSubmitEmail(),r.setState({uiState:"success"})}).catch(function(e){if(e.response){var t=e.response.email||e.response.non_field_errors||"";r.setState({error:t,uiState:"capture"})}else r.setState({error:"",uiState:"failure"})})}},{key:"renderEmailEntry",value:function(){var e=this.state,t=e.universityLogo,r=e.email,a=e.uiState,n=e.error;e.csrfToken;return i.default.createElement(s.default,{universityLogo:t},i.default.createElement("div",{className:"attention"},i.default.createElement("p",null,"Welcome!"),i.default.createElement("p",null,"Get instant access through your library.")),i.default.createElement("div",{className:"messaging"},i.default.createElement("p",null,"Just enter your academic institution email below:"),i.default.createElement("div",{className:"input-container"+(n?" error":"")},i.default.createElement("input",{type:"text",name:"email",placeholder:"Academic email",value:r,onChange:this.handleInputChange,ref:function(e){return e&&e.focus()}})),n?i.default.createElement("small",{className:"error"},n):"",i.default.createElement("p",null,i.default.createElement("a",{href:this.modifyPathIfHostNameMatches(this.props.signInUrl)},"Already a user? Click here.")),i.default.createElement("p",null,"We will use your personal data in accordance with our ",i.default.createElement("a",{href:"/privacy"},"Privacy Policy"),".")),i.default.createElement("div",{className:"buttonBox"},"loading"===a?i.default.createElement("img",{className:"spinner",src:"/library/view/static/images/loading.gif",alt:""}):i.default.createElement("button",{className:"cta",onClick:this.determineSsoStatus},"Let's Go")))}},{key:"renderSuccessMessage",value:function(){var e=this.state.universityLogo;return i.default.createElement(s.default,{className:"successModal",universityLogo:e},i.default.createElement("div",{className:"attention centered"},i.default.createElement("span",null,"You're in!")),i.default.createElement("div",{className:"messaging centered"},i.default.createElement("p",null,"Want more? Check your email for details on how to set up an account. It's free for students.")),i.default.createElement("div",{className:"buttonBox"},i.default.createElement("a",{className:"cta",href:this.modifyPathIfHostNameMatches(this.props.readingUrl),onClick:this.handleStartReading},"Got It")))}},{key:"renderFailureMessage",value:function(){var e=this.state.universityLogo;return i.default.createElement(s.default,{universityLogo:e},i.default.createElement("div",{className:"attention centered error"},i.default.createElement("div",null,i.default.createElement("img",{className:"error-alert",src:"/library/view/static/images/icons/exclamation-alert.svg",alt:"Alert"})),"An error has occurred with the site."),i.default.createElement("div",{className:"messaging centered error"},i.default.createElement("p",null,"Please go back and re-enter your email address.")),i.default.createElement("div",{className:"buttonBox"},i.default.createElement("button",{className:"cta",onClick:function(){return window.location.reload(!0)}},"Try Again")))}},{key:"renderSsoMessage",value:function(){var e=this.state.universityLogo;return i.default.createElement(s.default,{className:"ssoModal",universityLogo:e},i.default.createElement("div",{className:"attention centered"},i.default.createElement("span",null,"Welcome to Safari!")),i.default.createElement("div",{className:"messaging centered"},i.default.createElement("p",null,"You have a free Safari account, courtesy of this library. Please wait while we connect.")))}},{key:"render",value:function(){var e=this.state,t=e.show,r=e.uiState;return t?"ezproxy-sso"==r?this.renderSsoMessage():"success"===r?this.renderSuccessMessage():"failure"===r?this.renderFailureMessage():"sso"==r?this.renderSsoMessage():this.renderEmailEntry():null}}]),StudentIntercept}();d.propTypes={readingUrl:o.default.string.isRequired,signInUrl:o.default.string.isRequired,forceShow:o.default.bool.isRequired,ssoMsgTimeoutMs:o.default.number.isRequired},t.default=d,e.exports=t.default},694:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=_interopRequireDefault(r(2)),n=_interopRequireDefault(r(0));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var i=function(e){var t=e.children,r=e.universityLogo;return a.default.createElement("div",{className:"backdrop"},a.default.createElement("div",{className:"modal "+e.className},a.default.createElement("div",{className:"header"},r?a.default.createElement("img",{className:"uni-logo",src:r,alt:"University logo"}):"",a.default.createElement("img",{className:"brand-logo",src:"/library/view/static/images/brand/red_orm_safari.svg",alt:"Safari"})),a.default.createElement("div",{className:"content"},t)))};i.propTypes={children:n.default.oneOfType([n.default.arrayOf(n.default.node),n.default.node]),className:n.default.string,universityLogo:n.default.string},t.default=i,e.exports=t.default},89:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,n=function(){function defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,t,r){return t&&defineProperties(e.prototype,t),r&&defineProperties(e,r),e}}(),i=r(3),o=(a=i)&&a.__esModule?a:{default:a};var l="Anybird",s=function(){function Analytics(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Analytics)}return n(Analytics,[{key:"initialize",value:function(){var t=this;(0,o.default)(".ga-start-viewing-content").on("click",function(){var e=-1<(0,o.default)(this).text().indexOf("reading")?"Book":"Video";t.track(l,"View Content Preview",e)}),(0,o.default)("*[data-ga-label]").on("click",function(){var e=(0,o.default)(this).attr("data-ga-label");t.track(l,"Trial Register",e)}),(0,o.default)(".ga-latest-edition-title").on("click",function(){t.track(l,"Get Latest Edition")})}},{key:"track",value:function(e,t,r){if(window.ga&&window.ga.loaded)ga("send","event",e,t,r);else{var a=this;setTimeout(function(){a.track(e,t,r)},50)}}}]),Analytics}();t.default=s,e.exports=t.default}});